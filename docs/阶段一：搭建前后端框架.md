# é˜¶æ®µä¸€ï¼šæ­å»ºå‰åç«¯æ¡†æ¶

> **æ–‡æ¡£ç‰ˆæœ¬**: v1.0
> **æœ€åæ›´æ–°**: 2025-12-15
> **é€‚ç”¨èŒƒå›´**: ç°ä»£åŒ–å‰åç«¯åˆ†ç¦»é¡¹ç›®
> **æ¶æ„æ¨¡å¼**: Clean Architecture + DDD

---

## ğŸ“‹ ç›®å½•

- [1. é¡¹ç›®æ¦‚è¿°](#1-é¡¹ç›®æ¦‚è¿°)
- [2. æŠ€æœ¯æ ˆé€‰æ‹©](#2-æŠ€æœ¯æ ˆé€‰æ‹©)
- [3. ç›®å½•ç»“æ„è®¾è®¡](#3-ç›®å½•ç»“æ„è®¾è®¡)
- [4. åç«¯å¼€å‘è§„èŒƒ](#4-åç«¯å¼€å‘è§„èŒƒ)
- [5. å‰ç«¯å¼€å‘è§„èŒƒ](#5-å‰ç«¯å¼€å‘è§„èŒƒ)
- [6. æ•°æ®åº“è®¾è®¡](#6-æ•°æ®åº“è®¾è®¡)
- [7. APIè®¾è®¡è§„èŒƒ](#7-apiè®¾è®¡è§„èŒƒ)
- [8. å®‰å…¨ä¸è®¤è¯](#8-å®‰å…¨ä¸è®¤è¯)
- [9. æµ‹è¯•ç­–ç•¥](#9-æµ‹è¯•ç­–ç•¥)
- [10. éƒ¨ç½²æ¶æ„](#10-éƒ¨ç½²æ¶æ„)
- [11. å¼€å‘å·¥å…·é…ç½®](#11-å¼€å‘å·¥å…·é…ç½®)
- [12. éªŒæ”¶æ ‡å‡†](#12-éªŒæ”¶æ ‡å‡†)

---

## 1. é¡¹ç›®æ¦‚è¿°

### 1.1 é¡¹ç›®ç›®æ ‡
æ„å»ºä¸€ä¸ª**é«˜è´¨é‡ã€é«˜æ ‡å‡†ã€é«˜å¯ç»´æŠ¤æ€§**çš„ç°ä»£åŒ–å‰åç«¯åˆ†ç¦»åº”ç”¨ï¼Œéµå¾ªClean Architectureå’ŒDDDï¼ˆé¢†åŸŸé©±åŠ¨è®¾è®¡ï¼‰åŸåˆ™ã€‚

### 1.2 æ ¸å¿ƒåŸåˆ™
- **åˆ†å±‚æ¶æ„**: æ¸…æ™°çš„åˆ†å±‚ï¼Œæ˜ç¡®çš„ä¾èµ–å…³ç³»
- **é¢†åŸŸé©±åŠ¨**: ä»¥ä¸šåŠ¡ä¸ºæ ¸å¿ƒï¼ŒæŠ€æœ¯æœåŠ¡äºä¸šåŠ¡
- **é«˜å†…èšä½è€¦åˆ**: æ¨¡å—èŒè´£å•ä¸€ï¼Œä¾èµ–æœ€å°åŒ–
- **å¯æµ‹è¯•**: ä»£ç æ˜“äºå•å…ƒæµ‹è¯•å’Œé›†æˆæµ‹è¯•
- **å¯æ‰©å±•**: æ”¯æŒä¸šåŠ¡å¿«é€Ÿè¿­ä»£å’Œæ‰©å±•

### 1.3 è´¨é‡æ ‡å‡†
- ä»£ç è¦†ç›–ç‡ â‰¥ 80%
- APIå“åº”æ—¶é—´ < 200ms (95%åˆ†ä½)
- å‰ç«¯é¦–å±åŠ è½½ < 3s
- é›¶é«˜å±å®‰å…¨æ¼æ´
- å®Œæ•´çš„æ–‡æ¡£è¦†ç›–

---

## 2. æŠ€æœ¯æ ˆé€‰æ‹©

### 2.1 åç«¯æŠ€æœ¯æ ˆ

| ç±»åˆ« | æŠ€æœ¯ | ç‰ˆæœ¬ | é€‰æ‹©ç†ç”± |
|------|------|------|----------|
| **è¯­è¨€** | Python | 3.11+ | è¯­æ³•ç®€æ´ï¼Œç”Ÿæ€ä¸°å¯Œï¼Œå¼€å‘æ•ˆç‡é«˜ |
| **Webæ¡†æ¶** | FastAPI | 0.100+ | é«˜æ€§èƒ½ã€è‡ªåŠ¨APIæ–‡æ¡£ã€ç±»å‹æç¤ºæ”¯æŒ |
| **ORM** | SQLAlchemy | 2.0+ | æˆç†Ÿç¨³å®šã€å¼ºå¤§æŸ¥è¯¢ã€å¼‚æ­¥æ”¯æŒ |
| **æ•°æ®åº“** | PostgreSQL | 15+ | åŠŸèƒ½å¼ºå¤§ã€JSONæ”¯æŒã€ACIDç‰¹æ€§ |
| **ç¼“å­˜** | Redis | 7.0+ | é«˜æ€§èƒ½ã€æ•°æ®ç»“æ„ä¸°å¯Œã€æŒä¹…åŒ– |
| **APIæ–‡æ¡£** | Swagger/OpenAPI | 3.0 | è‡ªåŠ¨ç”Ÿæˆã€äº¤äº’å¼æ–‡æ¡£ |
| **è®¤è¯** | JWT | - | æ— çŠ¶æ€ã€å¯æ‰©å±• |
| **æµ‹è¯•** | pytest | 7.0+ | æˆç†Ÿç”Ÿæ€ã€ä¸°å¯Œæ’ä»¶ |
| **éƒ¨ç½²** | Docker | 24.0+ | ç¯å¢ƒä¸€è‡´æ€§ã€æ˜“äºéƒ¨ç½² |

**é€‰æ‹©ç†ç”±æ€»ç»“:**
- Pythonç”Ÿæ€ç³»ç»Ÿæˆç†Ÿï¼Œå¼€å‘æ•ˆç‡é«˜
- FastAPIæä¾›å“è¶Šçš„æ€§èƒ½å’Œå¼€å‘ä½“éªŒ
- PostgreSQL + Redisæ»¡è¶³å¤§éƒ¨åˆ†ä¸šåŠ¡åœºæ™¯
- ç°ä»£åŒ–å·¥å…·é“¾æ”¯æŒå¿«é€Ÿè¿­ä»£

### 2.2 å‰ç«¯æŠ€æœ¯æ ˆ

| ç±»åˆ« | æŠ€æœ¯ | ç‰ˆæœ¬ | é€‰æ‹©ç†ç”± |
|------|------|------|----------|
| **æ¡†æ¶** | Vue.js | 3.4+ | æ¸è¿›å¼ã€å­¦ä¹ æ›²çº¿å¹³ç¼“ã€æ€§èƒ½ä¼˜å¼‚ |
| **è¯­è¨€** | TypeScript | 5.0+ | ç±»å‹å®‰å…¨ã€IDEæ”¯æŒã€ä¾¿äºé‡æ„ |
| **çŠ¶æ€ç®¡ç†** | Pinia | 2.0+ | è½»é‡çº§ã€TypeScriptå‹å¥½ã€æ¨¡å—åŒ– |
| **è·¯ç”±** | Vue Router | 4.0+ | å®˜æ–¹è·¯ç”±ã€æ‡’åŠ è½½æ”¯æŒ |
| **UIç»„ä»¶** | Element Plus | 2.4+ | Vue3åŸç”Ÿã€ç»„ä»¶ä¸°å¯Œã€ä¸»é¢˜å®šåˆ¶ |
| **æ„å»ºå·¥å…·** | Vite | 5.0+ | æé€ŸHMRã€ç°ä»£åŒ–æ„å»º |
| **HTTPå®¢æˆ·ç«¯** | Axios | 1.6+ | ç”Ÿæ€æˆç†Ÿã€æ‹¦æˆªå™¨æ”¯æŒ |
| **å·¥å…·åº“** | Lodash | 4.17+ | å®ç”¨å‡½æ•°åº“ã€TypeScriptæ”¯æŒ |
| **æ—¶é—´å¤„ç†** | Day.js | 1.11+ | è½»é‡çº§ã€æ’ä»¶åŒ– |
| **æµ‹è¯•** | Vitest | 1.0+ | ç°ä»£åŒ–æµ‹è¯•æ¡†æ¶ã€Viteé›†æˆ |

**é€‰æ‹©ç†ç”±æ€»ç»“:**
- Vue3 Composition APIæä¾›æ›´å¥½çš„é€»è¾‘å¤ç”¨
- TypeScriptç¡®ä¿å‰ç«¯ä»£ç è´¨é‡
- Viteæä¾›å“è¶Šçš„å¼€å‘ä½“éªŒ
- Element PlusåŠ é€ŸUIå¼€å‘

### 2.3 DevOpsæŠ€æœ¯æ ˆ

| æŠ€æœ¯ | ç”¨é€” | ç‰ˆæœ¬ |
|------|------|------|
| **Docker** | å®¹å™¨åŒ– | 24.0+ |
| **Docker Compose** | å¤šå®¹å™¨ç¼–æ’ | 2.20+ |
| **Nginx** | åå‘ä»£ç†/é™æ€èµ„æº | 1.25+ |
| **GitHub Actions** | CI/CD | - |
| **ESLint** | ä»£ç è§„èŒƒ | 8.0+ |
| **Prettier** | ä»£ç æ ¼å¼åŒ– | 3.0+ |

---

## 3. ç›®å½•ç»“æ„è®¾è®¡

### 3.1 æ€»ä½“ç›®å½•ç»“æ„

```
project-root/
â”œâ”€â”€ backend/                          # åç«¯åº”ç”¨
â”‚   â”œâ”€â”€ app/
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ main.py                   # FastAPIå…¥å£
â”‚   â”‚   â”œâ”€â”€ config.py                 # é…ç½®ç®¡ç†
â”‚   â”‚   â”œâ”€â”€ dependencies.py           # ä¾èµ–æ³¨å…¥
â”‚   â”‚   â”œâ”€â”€ api/                      # APIæ¥å£å±‚
â”‚   â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”‚   â””â”€â”€ v1/
â”‚   â”‚   â”‚       â”œâ”€â”€ __init__.py
â”‚   â”‚   â”‚       â”œâ”€â”€ projects.py       # é¡¹ç›®ç›¸å…³API
â”‚   â”‚   â”‚       â”œâ”€â”€ tasks.py          # ä»»åŠ¡ç›¸å…³API
â”‚   â”‚   â”‚       â””â”€â”€ users.py          # ç”¨æˆ·ç›¸å…³API
â”‚   â”‚   â”œâ”€â”€ core/                     # æ ¸å¿ƒæ¨¡å—
â”‚   â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”‚   â”œâ”€â”€ security.py           # å®‰å…¨ç›¸å…³
â”‚   â”‚   â”‚   â””â”€â”€ exceptions.py         # å¼‚å¸¸å¤„ç†
â”‚   â”‚   â”œâ”€â”€ models/                   # æ•°æ®æ¨¡å‹
â”‚   â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”‚   â”œâ”€â”€ user.py
â”‚   â”‚   â”‚   â”œâ”€â”€ project.py
â”‚   â”‚   â”‚   â””â”€â”€ task.py
â”‚   â”‚   â”œâ”€â”€ schemas/                  # Pydanticæ¨¡å‹
â”‚   â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”‚   â”œâ”€â”€ user.py
â”‚   â”‚   â”‚   â”œâ”€â”€ project.py
â”‚   â”‚   â”‚   â””â”€â”€ task.py
â”‚   â”‚   â”œâ”€â”€ services/                 # ä¸šåŠ¡é€»è¾‘
â”‚   â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”‚   â”œâ”€â”€ user_service.py
â”‚   â”‚   â”‚   â”œâ”€â”€ project_service.py
â”‚   â”‚   â”‚   â””â”€â”€ task_service.py
â”‚   â”‚   â”œâ”€â”€ repositories/             # æ•°æ®è®¿é—®å±‚
â”‚   â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”‚   â”œâ”€â”€ base.py
â”‚   â”‚   â”‚   â”œâ”€â”€ user_repo.py
â”‚   â”‚   â”‚   â”œâ”€â”€ project_repo.py
â”‚   â”‚   â”‚   â””â”€â”€ task_repo.py
â”‚   â”‚   â””â”€â”€ utils/                    # å·¥å…·å‡½æ•°
â”‚   â”‚       â”œâ”€â”€ __init__.py
â”‚   â”‚       â”œâ”€â”€ logger.py
â”‚   â”‚       â””â”€â”€ validators.py
â”‚   â”œâ”€â”€ alembic/                      # æ•°æ®åº“è¿ç§»
â”‚   â”‚   â”œâ”€â”€ env.py
â”‚   â”‚   â”œâ”€â”€ script.py.mako
â”‚   â”‚   â””â”€â”€ versions/
â”‚   â”œâ”€â”€ tests/                        # æµ‹è¯•
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ conftest.py
â”‚   â”‚   â”œâ”€â”€ unit/
â”‚   â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”‚   â”œâ”€â”€ test_user_service.py
â”‚   â”‚   â”‚   â””â”€â”€ test_project_service.py
â”‚   â”‚   â””â”€â”€ integration/
â”‚   â”‚       â”œâ”€â”€ __init__.py
â”‚   â”‚       â””â”€â”€ test_api.py
â”‚   â”œâ”€â”€ requirements.txt
â”‚   â”œâ”€â”€ requirements-dev.txt
â”‚   â”œâ”€â”€ .env.example
â”‚   â”œâ”€â”€ Dockerfile
â”‚   â””â”€â”€ docker-compose.yml
â”‚
â”œâ”€â”€ frontend/                         # å‰ç«¯åº”ç”¨
â”‚   â”œâ”€â”€ public/                       # é™æ€èµ„æº
â”‚   â”‚   â”œâ”€â”€ index.html
â”‚   â”‚   â””â”€â”€ favicon.ico
â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”œâ”€â”€ main.ts                   # å…¥å£æ–‡ä»¶
â”‚   â”‚   â”œâ”€â”€ App.vue                   # æ ¹ç»„ä»¶
â”‚   â”‚   â”œâ”€â”€ router/
â”‚   â”‚   â”‚   â””â”€â”€ index.ts              # è·¯ç”±é…ç½®
â”‚   â”‚   â”œâ”€â”€ store/                    # PiniaçŠ¶æ€ç®¡ç†
â”‚   â”‚   â”‚   â”œâ”€â”€ index.ts
â”‚   â”‚   â”‚   â”œâ”€â”€ user.ts
â”‚   â”‚   â”‚   â”œâ”€â”€ project.ts
â”‚   â”‚   â”‚   â””â”€â”€ task.ts
â”‚   â”‚   â”œâ”€â”€ api/                      # APIæ¥å£
â”‚   â”‚   â”‚   â”œâ”€â”€ client.ts             # HTTPå®¢æˆ·ç«¯
â”‚   â”‚   â”‚   â”œâ”€â”€ user.ts
â”‚   â”‚   â”‚   â”œâ”€â”€ project.ts
â”‚   â”‚   â”‚   â””â”€â”€ task.ts
â”‚   â”‚   â”œâ”€â”€ views/                    # é¡µé¢ç»„ä»¶
â”‚   â”‚   â”‚   â”œâ”€â”€ Home.vue
â”‚   â”‚   â”‚   â”œâ”€â”€ Login.vue
â”‚   â”‚   â”‚   â”œâ”€â”€ Dashboard.vue
â”‚   â”‚   â”‚   â”œâ”€â”€ ProjectList.vue
â”‚   â”‚   â”‚   â”œâ”€â”€ ProjectDetail.vue
â”‚   â”‚   â”‚   â””â”€â”€ TaskDetail.vue
â”‚   â”‚   â”œâ”€â”€ components/               # é€šç”¨ç»„ä»¶
â”‚   â”‚   â”‚   â”œâ”€â”€ BaseButton.vue
â”‚   â”‚   â”‚   â”œâ”€â”€ BaseTable.vue
â”‚   â”‚   â”‚   â”œâ”€â”€ BaseModal.vue
â”‚   â”‚   â”‚   â”œâ”€â”€ UserCard.vue
â”‚   â”‚   â”‚   â””â”€â”€ ProjectCard.vue
â”‚   â”‚   â”œâ”€â”€ composables/              # ç»„åˆå¼å‡½æ•°
â”‚   â”‚   â”‚   â”œâ”€â”€ useUser.ts
â”‚   â”‚   â”‚   â”œâ”€â”€ useProject.ts
â”‚   â”‚   â”‚   â””â”€â”€ useAuth.ts
â”‚   â”‚   â”œâ”€â”€ types/                    # TypeScriptç±»å‹
â”‚   â”‚   â”‚   â”œâ”€â”€ user.ts
â”‚   â”‚   â”‚   â”œâ”€â”€ project.ts
â”‚   â”‚   â”‚   â””â”€â”€ task.ts
â”‚   â”‚   â”œâ”€â”€ utils/                    # å·¥å…·å‡½æ•°
â”‚   â”‚   â”‚   â”œâ”€â”€ date.ts
â”‚   â”‚   â”‚   â”œâ”€â”€ format.ts
â”‚   â”‚   â”‚   â””â”€â”€ validation.ts
â”‚   â”‚   â””â”€â”€ assets/                   # èµ„æºæ–‡ä»¶
â”‚   â”‚       â”œâ”€â”€ styles/
â”‚   â”‚       â”‚   â”œâ”€â”€ main.scss
â”‚   â”‚       â”‚   â””â”€â”€ variables.scss
â”‚   â”‚       â””â”€â”€ images/
â”‚   â”œâ”€â”€ tests/                        # æµ‹è¯•
â”‚   â”‚   â”œâ”€â”€ unit/
â”‚   â”‚   â”‚   â”œâ”€â”€ components/
â”‚   â”‚   â”‚   â”œâ”€â”€ views/
â”‚   â”‚   â”‚   â””â”€â”€ utils/
â”‚   â”‚   â””â”€â”€ e2e/
â”‚   â”œâ”€â”€ index.html
â”‚   â”œâ”€â”€ package.json
â”‚   â”œâ”€â”€ package-lock.json
â”‚   â”œâ”€â”€ vite.config.ts
â”‚   â”œâ”€â”€ tsconfig.json
â”‚   â”œâ”€â”€ .eslintrc.js
â”‚   â”œâ”€â”€ .prettierrc.js
â”‚   â”œâ”€â”€ Dockerfile
â”‚   â””â”€â”€ nginx.conf
â”‚
â”œâ”€â”€ docs/                             # æ–‡æ¡£
â”‚   â”œâ”€â”€ api/
â”‚   â”‚   â”œâ”€â”€ README.md
â”‚   â”‚   â””â”€â”€ examples.md
â”‚   â”œâ”€â”€ architecture/
â”‚   â”‚   â”œâ”€â”€ overview.md
â”‚   â”‚   â””â”€â”€ database.md
â”‚   â””â”€â”€ deployment/
â”‚       â”œâ”€â”€ local.md
â”‚       â””â”€â”€ production.md
â”‚
â”œâ”€â”€ scripts/                          # è„šæœ¬
â”‚   â”œâ”€â”€ setup.sh
â”‚   â”œâ”€â”€ deploy.sh
â”‚   â””â”€â”€ migrate.sh
â”‚
â”œâ”€â”€ .gitignore
â”œâ”€â”€ README.md
â”œâ”€â”€ docker-compose.yml                # æ ¹ç›®å½•ç¼–æ’
â””â”€â”€ docker-compose.override.yml       # æœ¬åœ°å¼€å‘è¦†ç›–
```

### 3.2 ç›®å½•è®¾è®¡åŸåˆ™

#### 3.2.1 åˆ†å±‚æ¶æ„
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              APIæ¥å£å±‚                    â”‚
â”‚           (Controllers)                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              åº”ç”¨æœåŠ¡å±‚                   â”‚
â”‚         (Services/Facades)               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              é¢†åŸŸæ¨¡å‹å±‚                   â”‚
â”‚     (Domain Models + Logic)              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              æ•°æ®è®¿é—®å±‚                   â”‚
â”‚         (Repositories)                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### 3.2.2 å‘½åè§„èŒƒ
- **æ–‡ä»¶å‘½å**: ä½¿ç”¨ä¸‹åˆ’çº¿åˆ†éš”ï¼ˆå°å†™ï¼‰
- **ç›®å½•å‘½å**: ä½¿ç”¨ä¸‹åˆ’çº¿åˆ†éš”ï¼ˆå°å†™ï¼‰
- **ç»„ä»¶å‘½å**: PascalCase (å¦‚: `UserProfile.vue`)
- **ç±»å‘½å**: PascalCase (å¦‚: `UserService`)
- **å¸¸é‡å‘½å**: UPPER_SNAKE_CASE (å¦‚: `MAX_RETRIES`)

---

## 4. åç«¯å¼€å‘è§„èŒƒ

### 4.1 é¡¹ç›®åˆå§‹åŒ–

#### 4.1.1 åˆ›å»ºè™šæ‹Ÿç¯å¢ƒ
```bash
# åˆ›å»ºè™šæ‹Ÿç¯å¢ƒ
python -m venv venv

# æ¿€æ´»è™šæ‹Ÿç¯å¢ƒ
# Windows
venv\Scripts\activate
# Linux/Mac
source venv/bin/activate
```

#### 4.1.2 å®‰è£…ä¾èµ–
```bash
# æ ¸å¿ƒä¾èµ–
pip install fastapi uvicorn[standard]
pip install sqlalchemy[asyncio] asyncpg
pip install pydantic[email] pydantic-settings
pip install python-jose[cryptography] passlib[bcrypt]
pip install redis
pip install alembic

# å¼€å‘ä¾èµ–
pip install pytest pytest-asyncio pytest-cov
pip install httpx  # APIæµ‹è¯•
pip install black isort flake8
pip install mypy
```

#### 4.1.3 é¡¹ç›®ç»“æ„åˆå§‹åŒ–è„šæœ¬
```bash
#!/bin/bash
# scripts/setup.sh

echo "Setting up backend..."

# åˆ›å»ºè™šæ‹Ÿç¯å¢ƒ
python -m venv venv
source venv/bin/activate

# å®‰è£…ä¾èµ–
pip install -r requirements.txt
pip install -r requirements-dev.txt

# åˆå§‹åŒ–æ•°æ®åº“
alembic init alembic
alembic revision --autogenerate -m "Initial migration"
alembic upgrade head

echo "Backend setup complete!"
```

### 4.2 ä»£ç è§„èŒƒ

#### 4.2.1 FastAPIåº”ç”¨ç»“æ„

**main.py** - åº”ç”¨å…¥å£
```python
from fastapi import FastAPI, Request
from fastapi.middleware.cors import CORSMiddleware
from contextlib import asynccontextmanager

from app.config import settings
from app.api.v1.api import api_router
from app.core.exceptions import (
    http_exception_handler,
    validation_exception_handler,
    general_exception_handler,
)
from fastapi.exceptions import RequestValidationError
from starlette.exceptions import HTTPException


@asynccontextmanager
async def lifespan(app: FastAPI):
    """åº”ç”¨ç”Ÿå‘½å‘¨æœŸç®¡ç†"""
    # å¯åŠ¨æ—¶æ‰§è¡Œ
    await startup()
    yield
    # å…³é—­æ—¶æ‰§è¡Œ
    await shutdown()


# åˆ›å»ºåº”ç”¨
app = FastAPI(
    title=settings.PROJECT_NAME,
    version=settings.VERSION,
    openapi_url=f"{settings.API_V1_STR}/openapi.json",
    lifespan=lifespan,
)

# æ³¨å†Œå¼‚å¸¸å¤„ç†å™¨
app.add_exception_handler(HTTPException, http_exception_handler)
app.add_exception_handler(RequestValidationError, validation_exception_handler)
app.add_exception_handler(Exception, general_exception_handler)

# é…ç½®CORS
app.add_middleware(
    CORSMiddleware,
    allow_origins=settings.BACKEND_CORS_ORIGINS,
    allow_credentials=True,
    allow_methods=["*"],
    allow_headers=["*"],
)

# æ³¨å†Œè·¯ç”±
app.include_router(api_router, prefix=settings.API_V1_STR)
```

#### 4.2.2 é…ç½®ç®¡ç† (config.py)
```python
from typing import Optional
from pydantic_settings import BaseSettings
from pydantic import AnyHttpUrl, validator


class Settings(BaseSettings):
    """åº”ç”¨é…ç½®"""

    # åŸºæœ¬ä¿¡æ¯
    PROJECT_NAME: str = "My Project"
    VERSION: str = "1.0.0"
    DESCRIPTION: str = "A modern API"
    API_V1_STR: str = "/api/v1"

    # å®‰å…¨
    SECRET_KEY: str
    ACCESS_TOKEN_EXPIRE_MINUTES: int = 60 * 24 * 8
    ALGORITHM: str = "HS256"

    # æ•°æ®åº“
    POSTGRES_SERVER: Optional[str] = None
    POSTGRES_USER: Optional[str] = None
    POSTGRES_PASSWORD: Optional[str] = None
    POSTGRES_DB: Optional[str] = None
    POSTGRES_PORT: Optional[str] = None
    POSTGRES_HOST: Optional[str] = None

    @property
    def SQLALCHEMY_DATABASE_URI(self) -> Optional[str]:
        if self.POSTGRES_DB:
            return (
                f"postgresql+asyncpg://{self.POSTGRES_USER}:{self.POSTGRES_PASSWORD}"
                f"@{self.POSTGRES_HOST}:{self.POSTGRES_PORT}/{self.POSTGRES_DB}"
            )
        return None

    # Redis
    REDIS_HOST: str = "localhost"
    REDIS_PORT: int = 6379
    REDIS_DB: int = 0
    REDIS_PASSWORD: Optional[str] = None

    # CORS
    BACKEND_CORS_ORIGINS: list[AnyHttpUrl] = []

    # æ—¥å¿—
    LOG_LEVEL: str = "INFO"

    # åˆ†é¡µ
    PAGINATION_SIZE: int = 20
    PAGINATION_MAX_SIZE: int = 100

    class Config:
        env_file = ".env"


settings = Settings()
```

#### 4.2.3 æ•°æ®åº“æ¨¡å‹ (models/user.py)
```python
from sqlalchemy import Column, String, Boolean, DateTime, Text
from sqlalchemy.dialects.postgresql import UUID
from sqlalchemy.orm import relationship
from sqlalchemy.sql import func
import uuid

from app.db.base_class import Base


class User(Base):
    """ç”¨æˆ·æ¨¡å‹"""
    __tablename__ = "users"

    id = Column(UUID(as_uuid=True), primary_key=True, default=uuid.uuid4)
    email = Column(String(255), unique=True, index=True, nullable=False)
    username = Column(String(50), unique=True, index=True, nullable=False)
    full_name = Column(String(100), nullable=False)
    hashed_password = Column(String(255), nullable=False)
    is_active = Column(Boolean, default=True, nullable=False)
    is_superuser = Column(Boolean, default=False, nullable=False)
    created_at = Column(DateTime(timezone=True), server_default=func.now())
    updated_at = Column(DateTime(timezone=True), onupdate=func.now())

    # å…³ç³»
    projects = relationship("Project", back_populates="owner")

    def __repr__(self) -> str:
        return f"<User {self.username}>"
```

#### 4.2.4 Pydantic Schema (schemas/user.py)
```python
from typing import Optional
from pydantic import BaseModel, EmailStr, validator


class UserBase(BaseModel):
    """ç”¨æˆ·åŸºç¡€Schema"""
    email: EmailStr
    username: str
    full_name: str


class UserCreate(UserBase):
    """åˆ›å»ºç”¨æˆ·Schema"""
    password: str

    @validator('password')
    def validate_password(cls, v):
        if len(v) < 8:
            raise ValueError('å¯†ç é•¿åº¦ä¸èƒ½å°‘äº8ä½')
        return v


class UserUpdate(BaseModel):
    """æ›´æ–°ç”¨æˆ·Schema"""
    email: Optional[EmailStr] = None
    username: Optional[str] = None
    full_name: Optional[str] = None


class UserInDBBase(UserBase):
    """æ•°æ®åº“ç”¨æˆ·Schema"""
    id: str
    is_active: bool
    is_superuser: bool
    created_at: Optional[str] = None
    updated_at: Optional[str] = None

    class Config:
        from_attributes = True


class User(UserInDBBase):
    """ç”¨æˆ·å“åº”Schema"""
    pass
```

#### 4.2.5 Repositoryæ¨¡å¼ (repositories/user_repo.py)
```python
from typing import Optional, List
from sqlalchemy import select
from sqlalchemy.ext.asyncio import AsyncSession

from app.models.user import User
from app.schemas.user import UserCreate, UserUpdate
from app.repositories.base import BaseRepository


class UserRepository(BaseRepository[User, UserCreate, UserUpdate]):
    """ç”¨æˆ·ä»“å‚¨"""

    def __init__(self):
        super().__init__(User)

    async def get_by_email(self, db: AsyncSession, *, email: str) -> Optional[User]:
        """æ ¹æ®é‚®ç®±è·å–ç”¨æˆ·"""
        query = select(User).where(User.email == email)
        result = await db.execute(query)
        return result.scalar_one_or_none()

    async def get_by_username(self, db: AsyncSession, *, username: str) -> Optional[User]:
        """æ ¹æ®ç”¨æˆ·åè·å–ç”¨æˆ·"""
        query = select(User).where(User.username == username)
        result = await db.execute(query)
        return result.scalar_one_or_none()

    async def create(self, db: AsyncSession, *, obj_in: UserCreate) -> User:
        """åˆ›å»ºç”¨æˆ·"""
        # è¿™é‡Œä¼šä½¿ç”¨BaseRepositoryçš„createæ–¹æ³•
        return await super().create(db, obj_in=obj_in)
```

#### 4.2.6 Serviceå±‚ (services/user_service.py)
```python
from typing import Optional, List
from sqlalchemy.ext.asyncio import AsyncSession

from app.models.user import User
from app.schemas.user import UserCreate, UserUpdate
from app.repositories.user_repo import UserRepository
from app.core.security import get_password_hash, verify_password


class UserService:
    """ç”¨æˆ·æœåŠ¡"""

    def __init__(self):
        self.repository = UserRepository()

    async def get(self, db: AsyncSession, id: str) -> Optional[User]:
        """è·å–ç”¨æˆ·"""
        return await self.repository.get(db, id=id)

    async def get_by_email(self, db: AsyncSession, email: str) -> Optional[User]:
        """æ ¹æ®é‚®ç®±è·å–ç”¨æˆ·"""
        return await self.repository.get_by_email(db, email=email)

    async def create(self, db: AsyncSession, *, obj_in: UserCreate) -> User:
        """åˆ›å»ºç”¨æˆ·"""
        hashed_password = get_password_hash(obj_in.password)
        db_obj = UserCreate(
            email=obj_in.email,
            username=obj_in.username,
            full_name=obj_in.full_name,
            hashed_password=hashed_password
        )
        return await self.repository.create(db, obj_in=db_obj)

    async def authenticate(self, db: AsyncSession, *, email: str, password: str) -> Optional[User]:
        """ç”¨æˆ·è®¤è¯"""
        user = await self.get_by_email(db, email=email)
        if not user:
            return None
        if not verify_password(password, user.hashed_password):
            return None
        return user
```

#### 4.2.7 APIè·¯ç”± (api/v1/users.py)
```python
from typing import List
from fastapi import APIRouter, Depends, HTTPException, status, Query
from sqlalchemy.ext.asyncio import AsyncSession

from app.api import deps
from app.schemas.user import User, UserCreate, UserUpdate
from app.services.user_service import UserService

router = APIRouter()


@router.get("/users", response_model=List[User])
async def list_users(
    *,
    db: AsyncSession = Depends(deps.get_db),
    skip: int = Query(0, ge=0),
    limit: int = Query(100, ge=1, le=100),
    current_user: User = Depends(deps.get_current_user),
):
    """è·å–ç”¨æˆ·åˆ—è¡¨"""
    user_service = UserService()
    users = await user_service.get_multi(db, skip=skip, limit=limit)
    return users


@router.post("/users", response_model=User, status_code=status.HTTP_201_CREATED)
async def create_user(
    *,
    db: AsyncSession = Depends(deps.get_db),
    user_in: UserCreate,
    current_user: User = Depends(deps.get_current_superuser),
):
    """åˆ›å»ºç”¨æˆ·"""
    user_service = UserService()

    # æ£€æŸ¥ç”¨æˆ·æ˜¯å¦å·²å­˜åœ¨
    user = await user_service.get_by_email(db, email=user_in.email)
    if user:
        raise HTTPException(
            status_code=status.HTTP_400_BAD_REQUEST,
            detail="é‚®ç®±å·²è¢«æ³¨å†Œ"
        )

    user = await user_service.create(db, obj_in=user_in)
    return user


@router.get("/users/{user_id}", response_model=User)
async def get_user(
    *,
    db: AsyncSession = Depends(deps.get_db),
    user_id: str,
    current_user: User = Depends(deps.get_current_user),
):
    """è·å–ç”¨æˆ·è¯¦æƒ…"""
    user_service = UserService()
    user = await user_service.get(db, id=user_id)

    if not user:
        raise HTTPException(
            status_code=status.HTTP_404_NOT_FOUND,
            detail="ç”¨æˆ·ä¸å­˜åœ¨"
        )

    return user
```

### 4.3 æ•°æ®åº“è¿ç§»

#### 4.3.1 Alembicé…ç½® (alembic.ini)
```ini
[alembic]
script_location = alembic
prepend_sys_path = .
version_path_separator = os
sqlalchemy.url = driver://user:pass@localhost/dbname

[post_write_hooks]
hooks = black
black.type = console_scripts
black.entrypoint = black
black.options = -l 88 REVISION_SCRIPT_FILENAME

[loggers]
keys = root,sqlalchemy,alembic

[handlers]
keys = console

[formatters]
keys = generic

[logger_root]
level = WARN
handlers = console
qualname =

[logger_sqlalchemy]
level = WARN
handlers =
qualname = sqlalchemy.engine

[logger_alembic]
level = INFO
handlers =
qualname = alembic

[handler_console]
class = StreamHandler
args = (sys.stderr,)
level = NOTSET
formatter = generic

[formatter_generic]
format = %(levelname)-5.5s [%(name)s] %(message)s
datefmt = %H:%M:%S
```

#### 4.3.2 åˆå§‹åŒ–è¿ç§»
```bash
# åˆå§‹åŒ–alembic
alembic init alembic

# è‡ªåŠ¨ç”Ÿæˆè¿ç§»è„šæœ¬
alembic revision --autogenerate -m "Initial migration"

# æ‰§è¡Œè¿ç§»
alembic upgrade head

# åˆ›å»ºæ–°è¿ç§»
alembic revision -m "Add user table"

# å›æ»šè¿ç§»
alembic downgrade -1
```

---

## 5. å‰ç«¯å¼€å‘è§„èŒƒ

### 5.1 é¡¹ç›®åˆå§‹åŒ–

#### 5.1.1 åˆ›å»ºé¡¹ç›®
```bash
# ä½¿ç”¨Viteåˆ›å»ºVueé¡¹ç›®
npm create vue@latest frontend -- --typescript --router --pinia --vitest --cypress

# è¿›å…¥é¡¹ç›®ç›®å½•
cd frontend

# å®‰è£…ä¾èµ–
npm install

# å®‰è£…é¢å¤–ä¾èµ–
npm install axios element-plus @element-plus/icons-vue lodash dayjs
```

#### 5.1.2 å®‰è£…å¼€å‘ä¾èµ–
```bash
npm install -D @types/lodash
npm install -D prettier eslint-plugin-vue
npm install -D @typescript-eslint/parser @typescript-eslint/eslint-plugin
```

### 5.2 ä»£ç è§„èŒƒ

#### 5.2.1 Viteé…ç½® (vite.config.ts)
```typescript
import { defineConfig } from 'vite'
import vue from '@vitejs/plugin-vue'
import { resolve } from 'path'

export default defineConfig({
  plugins: [vue()],
  resolve: {
    alias: {
      '@': resolve(__dirname, 'src'),
    },
  },
  server: {
    port: 3000,
    proxy: {
      '/api': {
        target: 'http://localhost:8000',
        changeOrigin: true,
      },
    },
  },
  build: {
    rollupOptions: {
      output: {
        manualChunks: {
          vendor: ['vue', 'vue-router', 'pinia'],
          element: ['element-plus'],
        },
      },
    },
  },
})
```

#### 5.2.2 è·¯ç”±é…ç½® (router/index.ts)
```typescript
import { createRouter, createWebHistory } from 'vue-router'
import { useAuthStore } from '@/store/auth'

const router = createRouter({
  history: createWebHistory(),
  routes: [
    {
      path: '/',
      name: 'home',
      component: () => import('@/views/Dashboard.vue'),
      meta: { requiresAuth: true },
    },
    {
      path: '/login',
      name: 'login',
      component: () => import('@/views/Login.vue'),
      meta: { requiresGuest: true },
    },
    {
      path: '/projects',
      name: 'projects',
      component: () => import('@/views/ProjectList.vue'),
      meta: { requiresAuth: true },
    },
    {
      path: '/projects/:id',
      name: 'project-detail',
      component: () => import('@/views/ProjectDetail.vue'),
      meta: { requiresAuth: true },
    },
  ],
})

// è·¯ç”±å®ˆå«
router.beforeEach((to, from, next) => {
  const authStore = useAuthStore()

  if (to.meta.requiresAuth && !authStore.isAuthenticated) {
    next({ name: 'login' })
  } else if (to.meta.requiresGuest && authStore.isAuthenticated) {
    next({ name: 'home' })
  } else {
    next()
  }
})

export default router
```

#### 5.2.3 PiniaçŠ¶æ€ç®¡ç† (store/user.ts)
```typescript
import { defineStore } from 'pinia'
import { ref, computed } from 'vue'
import type { User } from '@/types/user'
import { userApi } from '@/api/user'

export const useUserStore = defineStore('user', () => {
  // çŠ¶æ€
  const currentUser = ref<User | null>(null)
  const users = ref<User[]>([])
  const loading = ref(false)
  const error = ref<string | null>(null)

  // è®¡ç®—å±æ€§
  const isAuthenticated = computed(() => !!currentUser.value)
  const isAdmin = computed(() => currentUser.value?.is_superuser || false)
  const activeUsers = computed(() => users.value.filter(u => u.is_active))

  // åŠ¨ä½œ
  async function fetchCurrentUser() {
    loading.value = true
    error.value = null
    try {
      currentUser.value = await userApi.getCurrentUser()
    } catch (e: any) {
      error.value = e.message
      throw e
    } finally {
      loading.value = false
    }
  }

  async function login(email: string, password: string) {
    loading.value = true
    error.value = null
    try {
      const response = await userApi.login({ email, password })
      localStorage.setItem('token', response.access_token)
      await fetchCurrentUser()
    } catch (e: any) {
      error.value = e.message
      throw e
    } finally {
      loading.value = false
    }
  }

  async function logout() {
    localStorage.removeItem('token')
    currentUser.value = null
  }

  async function fetchUsers() {
    loading.value = true
    try {
      users.value = await userApi.getUsers()
    } catch (e: any) {
      error.value = e.message
    } finally {
      loading.value = false
    }
  }

  return {
    // çŠ¶æ€
    currentUser,
    users,
    loading,
    error,
    // è®¡ç®—å±æ€§
    isAuthenticated,
    isAdmin,
    activeUsers,
    // åŠ¨ä½œ
    fetchCurrentUser,
    login,
    logout,
    fetchUsers,
  }
})
```

#### 5.2.4 APIå®¢æˆ·ç«¯ (api/client.ts)
```typescript
import axios, { AxiosInstance, AxiosError } from 'axios'

class ApiClient {
  private client: AxiosInstance

  constructor() {
    this.client = axios.create({
      baseURL: import.meta.env.VITE_API_BASE_URL || '/api/v1',
      timeout: 10000,
      headers: {
        'Content-Type': 'application/json',
      },
    })

    // è¯·æ±‚æ‹¦æˆªå™¨
    this.client.interceptors.request.use(
      (config) => {
        const token = localStorage.getItem('token')
        if (token) {
          config.headers.Authorization = `Bearer ${token}`
        }
        return config
      },
      (error) => Promise.reject(error)
    )

    // å“åº”æ‹¦æˆªå™¨
    this.client.interceptors.response.use(
      (response) => response,
      (error: AxiosError) => {
        if (error.response?.status === 401) {
          localStorage.removeItem('token')
          window.location.href = '/login'
        }
        return Promise.reject(error)
      }
    )
  }

  async get<T>(url: string, params?: any): Promise<T> {
    const response = await this.client.get<T>(url, { params })
    return response.data
  }

  async post<T>(url: string, data?: any): Promise<T> {
    const response = await this.client.post<T>(url, data)
    return response.data
  }

  async put<T>(url: string, data?: any): Promise<T> {
    const response = await this.client.put<T>(url, data)
    return response.data
  }

  async patch<T>(url: string, data?: any): Promise<T> {
    const response = await this.client.patch<T>(url, data)
    return response.data
  }

  async delete<T>(url: string): Promise<T> {
    const response = await this.client.delete<T>(url)
    return response.data
  }
}

export const apiClient = new ApiClient()
```

#### 5.2.5 è§†å›¾ç»„ä»¶ (views/Login.vue)
```vue
<template>
  <div class="login-container">
    <el-card class="login-card">
      <template #header>
        <h2>ç™»å½•</h2>
      </template>

      <el-form
        ref="formRef"
        :model="form"
        :rules="rules"
        label-width="80px"
        @submit.prevent="handleLogin"
      >
        <el-form-item label="é‚®ç®±" prop="email">
          <el-input
            v-model="form.email"
            type="email"
            placeholder="è¯·è¾“å…¥é‚®ç®±"
          />
        </el-form-item>

        <el-form-item label="å¯†ç " prop="password">
          <el-input
            v-model="form.password"
            type="password"
            placeholder="è¯·è¾“å…¥å¯†ç "
            show-password
          />
        </el-form-item>

        <el-form-item>
          <el-button
            type="primary"
            :loading="loading"
            @click="handleLogin"
          >
            ç™»å½•
          </el-button>
        </el-form-item>
      </el-form>
    </el-card>
  </div>
</template>

<script setup lang="ts">
import { ref, reactive } from 'vue'
import { useRouter } from 'vue-router'
import { useUserStore } from '@/store/user'
import { ElMessage } from 'element-plus'
import type { FormInstance, FormRules } from 'element-plus'

const router = useRouter()
const userStore = useUserStore()

const formRef = ref<FormInstance>()
const loading = ref(false)

const form = reactive({
  email: '',
  password: '',
})

const rules: FormRules = {
  email: [
    { required: true, message: 'è¯·è¾“å…¥é‚®ç®±', trigger: 'blur' },
    { type: 'email', message: 'é‚®ç®±æ ¼å¼ä¸æ­£ç¡®', trigger: 'blur' },
  ],
  password: [
    { required: true, message: 'è¯·è¾“å…¥å¯†ç ', trigger: 'blur' },
    { min: 8, message: 'å¯†ç é•¿åº¦ä¸èƒ½å°‘äº8ä½', trigger: 'blur' },
  ],
}

async function handleLogin() {
  if (!formRef.value) return

  await formRef.value.validate(async (valid) => {
    if (valid) {
      try {
        loading.value = true
        await userStore.login(form.email, form.password)
        ElMessage.success('ç™»å½•æˆåŠŸ')
        router.push('/')
      } catch (error: any) {
        ElMessage.error(error.message || 'ç™»å½•å¤±è´¥')
      } finally {
        loading.value = false
      }
    }
  })
}
</script>

<style scoped>
.login-container {
  display: flex;
  justify-content: center;
  align-items: center;
  min-height: 100vh;
  background-color: #f5f5f5;
}

.login-card {
  width: 400px;
}
</style>
```

### 5.3 TypeScriptç±»å‹å®šä¹‰

#### 5.3.1 ç±»å‹å®šä¹‰ (types/user.ts)
```typescript
export interface User {
  id: string
  email: string
  username: string
  full_name: string
  is_active: boolean
  is_superuser: boolean
  created_at: string
  updated_at: string
}

export interface UserCreate {
  email: string
  username: string
  full_name: string
  password: string
}

export interface UserUpdate {
  email?: string
  username?: string
  full_name?: string
  is_active?: boolean
}

export interface LoginRequest {
  email: string
  password: string
}

export interface LoginResponse {
  access_token: string
  token_type: string
  expires_in: number
}
```

#### 5.3.2 é€šç”¨ç±»å‹ (types/common.ts)
```typescript
export interface PaginationParams {
  page: number
  page_size: number
}

export interface PaginatedResponse<T> {
  items: T[]
  total: number
  page: number
  page_size: number
  total_pages: number
}

export interface ApiError {
  detail: string
  error_code?: string
  errors?: Record<string, string[]>
}

export type LoadingState = 'idle' | 'loading' | 'success' | 'error'
```

---

## 6. æ•°æ®åº“è®¾è®¡

### 6.1 è®¾è®¡åŸåˆ™

1. **èŒƒå¼åŒ–**: éµå¾ªç¬¬ä¸‰èŒƒå¼ï¼ˆ3NFï¼‰
2. **ä¸»é”®**: ä½¿ç”¨UUIDä½œä¸ºä¸»é”®
3. **å¤–é”®**: æ˜ç¡®çš„å¤–é”®å…³ç³»
4. **ç´¢å¼•**: åœ¨æŸ¥è¯¢å­—æ®µä¸Šåˆ›å»ºç´¢å¼•
5. **çº¦æŸ**: ä½¿ç”¨CHECKçº¦æŸç¡®ä¿æ•°æ®å®Œæ•´æ€§
6. **å®¡è®¡å­—æ®µ**: æ‰€æœ‰è¡¨åŒ…å«created_atå’Œupdated_at

### 6.2 æ ¸å¿ƒè¡¨ç»“æ„

#### 6.2.1 ç”¨æˆ·è¡¨ (users)
```sql
CREATE TABLE users (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    email VARCHAR(255) NOT NULL UNIQUE,
    username VARCHAR(50) NOT NULL UNIQUE,
    full_name VARCHAR(100) NOT NULL,
    hashed_password VARCHAR(255) NOT NULL,
    is_active BOOLEAN NOT NULL DEFAULT TRUE,
    is_superuser BOOLEAN NOT NULL DEFAULT FALSE,
    created_at TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP
);

CREATE INDEX idx_users_email ON users(email);
CREATE INDEX idx_users_username ON users(username);
CREATE INDEX idx_users_active ON users(is_active);
```

#### 6.2.2 é¡¹ç›®è¡¨ (projects)
```sql
CREATE TABLE projects (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    name VARCHAR(100) NOT NULL,
    description TEXT,
    owner_id UUID NOT NULL REFERENCES users(id) ON DELETE CASCADE,
    status VARCHAR(20) NOT NULL DEFAULT 'active'
        CHECK (status IN ('planning', 'active', 'completed', 'archived')),
    created_at TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP
);

CREATE INDEX idx_projects_owner ON projects(owner_id);
CREATE INDEX idx_projects_status ON projects(status);
```

#### 6.2.3 ä»»åŠ¡è¡¨ (tasks)
```sql
CREATE TABLE tasks (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    title VARCHAR(200) NOT NULL,
    description TEXT,
    project_id UUID NOT NULL REFERENCES projects(id) ON DELETE CASCADE,
    assignee_id UUID REFERENCES users(id) ON DELETE SET NULL,
    reporter_id UUID NOT NULL REFERENCES users(id) ON DELETE CASCADE,
    status VARCHAR(20) NOT NULL DEFAULT 'todo'
        CHECK (status IN ('todo', 'in_progress', 'in_review', 'done', 'blocked')),
    priority VARCHAR(10) NOT NULL DEFAULT 'medium'
        CHECK (priority IN ('low', 'medium', 'high', 'urgent')),
    due_date TIMESTAMP WITH TIME ZONE,
    completed_at TIMESTAMP WITH TIME ZONE,
    created_at TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP
);

CREATE INDEX idx_tasks_project ON tasks(project_id);
CREATE INDEX idx_tasks_assignee ON tasks(assignee_id);
CREATE INDEX idx_tasks_status ON tasks(status);
CREATE INDEX idx_tasks_priority ON tasks(priority);
CREATE INDEX idx_tasks_due_date ON tasks(due_date);
```

### 6.3 æ•°æ®åº“è¿ç§»è„šæœ¬

#### 6.3.1 åˆå§‹è¿ç§» (alembic/versions/001_initial.py)
```python
"""Initial migration

Revision ID: 001
Revises:
Create Date: 2025-12-15 10:00:00.000000

"""
from alembic import op
import sqlalchemy as sa
from sqlalchemy.dialects import postgresql

# revision identifiers
revision = '001'
down_revision = None
branch_labels = None
depends_on = None


def upgrade():
    # åˆ›å»ºç”¨æˆ·è¡¨
    op.create_table(
        'users',
        sa.Column('id', postgresql.UUID(as_uuid=True), nullable=False),
        sa.Column('email', sa.String(255), nullable=False),
        sa.Column('username', sa.String(50), nullable=False),
        sa.Column('full_name', sa.String(100), nullable=False),
        sa.Column('hashed_password', sa.String(255), nullable=False),
        sa.Column('is_active', sa.Boolean(), nullable=False),
        sa.Column('is_superuser', sa.Boolean(), nullable=False),
        sa.Column('created_at', sa.DateTime(timezone=True), nullable=True),
        sa.Column('updated_at', sa.DateTime(timezone=True), nullable=True),
        sa.PrimaryKeyConstraint('id')
    )

    op.create_index(op.f('ix_users_email'), 'users', ['email'], unique=True)
    op.create_index(op.f('ix_users_username'), 'users', ['username'], unique=True)

    # åˆ›å»ºé¡¹ç›®è¡¨
    op.create_table(
        'projects',
        sa.Column('id', postgresql.UUID(as_uuid=True), nullable=False),
        sa.Column('name', sa.String(100), nullable=False),
        sa.Column('description', sa.Text(), nullable=True),
        sa.Column('owner_id', postgresql.UUID(as_uuid=True), nullable=False),
        sa.Column('status', sa.String(20), nullable=False),
        sa.Column('created_at', sa.DateTime(timezone=True), nullable=True),
        sa.Column('updated_at', sa.DateTime(timezone=True), nullable=True),
        sa.ForeignKeyConstraint(['owner_id'], ['users.id'], ondelete='CASCADE'),
        sa.PrimaryKeyConstraint('id')
    )

    op.create_index(op.f('ix_projects_owner'), 'projects', ['owner_id'], unique=False)


def downgrade():
    op.drop_index(op.f('ix_projects_owner'), table_name='projects')
    op.drop_table('projects')
    op.drop_index(op.f('ix_users_username'), table_name='users')
    op.drop_index(op.f('ix_users_email'), table_name='users')
    op.drop_table('users')
```

---

## 7. APIè®¾è®¡è§„èŒƒ

### 7.1 RESTful APIè®¾è®¡åŸåˆ™

#### 7.1.1 URLè®¾è®¡
```
âœ… æ­£ç¡®ç¤ºä¾‹
GET    /api/v1/users              # è·å–ç”¨æˆ·åˆ—è¡¨
POST   /api/v1/users              # åˆ›å»ºç”¨æˆ·
GET    /api/v1/users/{id}         # è·å–ç‰¹å®šç”¨æˆ·
PUT    /api/v1/users/{id}         # æ›´æ–°ç”¨æˆ·ï¼ˆå®Œæ•´æ›´æ–°ï¼‰
PATCH  /api/v1/users/{id}         # æ›´æ–°ç”¨æˆ·ï¼ˆéƒ¨åˆ†æ›´æ–°ï¼‰
DELETE /api/v1/users/{id}         # åˆ é™¤ç”¨æˆ·

GET    /api/v1/projects/{id}/tasks    # è·å–é¡¹ç›®çš„ä»»åŠ¡
POST   /api/v1/projects/{id}/tasks    # ä¸ºé¡¹ç›®åˆ›å»ºä»»åŠ¡

âŒ é”™è¯¯ç¤ºä¾‹
GET    /api/v1/getUsers
POST   /api/v1/createUser
GET    /api/v1/user?id=123
```

#### 7.1.2 çŠ¶æ€ç ä½¿ç”¨
```python
# æˆåŠŸå“åº”
200 OK              # æˆåŠŸè·å–èµ„æº
201 Created         # æˆåŠŸåˆ›å»ºèµ„æº
204 No Content      # æˆåŠŸåˆ é™¤èµ„æº

# å®¢æˆ·ç«¯é”™è¯¯
400 Bad Request     # è¯·æ±‚å‚æ•°é”™è¯¯
401 Unauthorized    # æœªè®¤è¯
403 Forbidden       # æ— æƒé™
404 Not Found       # èµ„æºä¸å­˜åœ¨
409 Conflict        # èµ„æºå†²çªï¼ˆå¦‚é‡å¤åˆ›å»ºï¼‰

# æœåŠ¡å™¨é”™è¯¯
500 Internal Server Error
503 Service Unavailable
```

### 7.2 APIå“åº”æ ¼å¼

#### 7.2.1 æˆåŠŸå“åº”
```json
{
  "success": true,
  "data": {
    "id": "123",
    "email": "user@example.com",
    "username": "johndoe"
  },
  "message": "æ“ä½œæˆåŠŸ"
}
```

#### 7.2.2 é”™è¯¯å“åº”
```json
{
  "success": false,
  "error": {
    "code": "VALIDATION_ERROR",
    "message": "è¾“å…¥æ•°æ®éªŒè¯å¤±è´¥",
    "details": {
      "email": ["é‚®ç®±æ ¼å¼ä¸æ­£ç¡®"],
      "password": ["å¯†ç é•¿åº¦ä¸èƒ½å°‘äº8ä½"]
    }
  }
}
```

#### 7.2.3 åˆ†é¡µå“åº”
```json
{
  "success": true,
  "data": [
    { "id": "1", "name": "User 1" },
    { "id": "2", "name": "User 2" }
  ],
  "pagination": {
    "page": 1,
    "page_size": 20,
    "total": 100,
    "total_pages": 5
  }
}
```

### 7.3 APIæ–‡æ¡£

#### 7.3.1 Swagger/OpenAPIé…ç½®
```python
from fastapi import FastAPI
from fastapi.openapi.utils import get_openapi

def custom_openapi():
    if app.openapi_schema:
        return app.openapi_schema

    openapi_schema = get_openapi(
        title="Project Management API",
        version="1.0.0",
        description="A modern project management API",
        routes=app.routes,
    )

    openapi_schema["info"]["x-logo"] = {
        "url": "https://fastapi.tiangolo.com/img/logo-margin/logo-teal.png"
    }

    app.openapi_schema = openapi_schema
    return app.openapi_schema

app.openapi = custom_openapi
```

---

## 8. å®‰å…¨ä¸è®¤è¯

### 8.1 è®¤è¯æœºåˆ¶

#### 8.1.1 JWTä»¤ç‰Œ
```python
# core/security.py
from datetime import datetime, timedelta
from typing import Optional
from jose import jwt
from passlib.context import CryptContext

from app.config import settings

pwd_context = CryptContext(schemes=["bcrypt"], deprecated="auto")


def create_access_token(subject: str, expires_delta: Optional[timedelta] = None):
    """åˆ›å»ºJWTè®¿é—®ä»¤ç‰Œ"""
    if expires_delta:
        expire = datetime.utcnow() + expires_delta
    else:
        expire = datetime.utcnow() + timedelta(minutes=settings.ACCESS_TOKEN_EXPIRE_MINUTES)

    to_encode = {"exp": expire, "sub": str(subject)}
    encoded_jwt = jwt.encode(to_encode, settings.SECRET_KEY, algorithm=settings.ALGORITHM)
    return encoded_jwt


def verify_password(plain_password: str, hashed_password: str) -> bool:
    """éªŒè¯å¯†ç """
    return pwd_context.verify(plain_password, hashed_password)


def get_password_hash(password: str) -> str:
    """ç”Ÿæˆå¯†ç å“ˆå¸Œ"""
    return pwd_context.hash(password)


def verify_token(token: str) -> Optional[str]:
    """éªŒè¯JWTä»¤ç‰Œå¹¶è¿”å›ç”¨æˆ·ID"""
    try:
        payload = jwt.decode(token, settings.SECRET_KEY, algorithms=[settings.ALGORITHM])
        user_id: str = payload.get("sub")
        if user_id is None:
            return None
        return user_id
    except jwt.JWTError:
        return None
```

#### 8.1.2 ä¾èµ–æ³¨å…¥
```python
# api/deps.py
from typing import Generator, Optional
from fastapi import Depends, HTTPException, status
from fastapi.security import HTTPBearer, HTTPAuthorizationCredentials
from sqlalchemy.ext.asyncio import AsyncSession

from app.config import settings
from app.core.security import verify_token
from app.db.session import SessionLocal
from app.services.user_service import UserService

security = HTTPBearer()


async def get_db() -> Generator:
    """è·å–æ•°æ®åº“ä¼šè¯"""
    try:
        db = SessionLocal()
        yield db
    finally:
        await db.close()


async def get_current_user(
    db: AsyncSession = Depends(get_db),
    credentials: HTTPAuthorizationCredentials = Depends(security)
) -> User:
    """è·å–å½“å‰è®¤è¯ç”¨æˆ·"""
    credentials_exception = HTTPException(
        status_code=status.HTTP_401_UNAUTHORIZED,
        detail="æ— æ³•éªŒè¯èº«ä»½å‡­æ®",
        headers={"WWW-Authenticate": "Bearer"},
    )

    token = credentials.credentials
    user_id = verify_token(token)

    if user_id is None:
        raise credentials_exception

    user_service = UserService()
    user = await user_service.get(db, id=user_id)

    if user is None:
        raise credentials_exception

    if not user.is_active:
        raise HTTPException(status_code=400, detail="ç”¨æˆ·å·²è¢«ç¦ç”¨")

    return user


async def get_current_superuser(
    current_user: User = Depends(get_current_user),
) -> User:
    """è·å–å½“å‰è¶…çº§ç”¨æˆ·"""
    if not current_user.is_superuser:
        raise HTTPException(
            status_code=status.HTTP_403_FORBIDDEN,
            detail="æƒé™ä¸è¶³"
        )
    return current_user
```

### 8.2 æ•°æ®å®‰å…¨

#### 8.2.1 è¾“å…¥éªŒè¯
```python
# schemas/user.py
from pydantic import BaseModel, EmailStr, validator, Field
from typing import Optional


class UserCreate(BaseModel):
    email: EmailStr
    username: str = Field(..., min_length=3, max_length=50)
    full_name: str = Field(..., min_length=1, max_length=100)
    password: str = Field(..., min_length=8, max_length=100)

    @validator('username')
    def username_alphanumeric(cls, v):
        assert v.isalnum(), 'ç”¨æˆ·ååªèƒ½åŒ…å«å­—æ¯å’Œæ•°å­—'
        return v

    @validator('password')
    def password_strength(cls, v):
        assert any(c.isupper() for c in v), 'å¯†ç å¿…é¡»åŒ…å«è‡³å°‘ä¸€ä¸ªå¤§å†™å­—æ¯'
        assert any(c.islower() for c in v), 'å¯†ç å¿…é¡»åŒ…å«è‡³å°‘ä¸€ä¸ªå°å†™å­—æ¯'
        assert any(c.isdigit() for c in v), 'å¯†ç å¿…é¡»åŒ…å«è‡³å°‘ä¸€ä¸ªæ•°å­—'
        return v
```

#### 8.2.2 SQLæ³¨å…¥é˜²æŠ¤
```python
# repositories/base.py
from typing import Any, Dict, Generic, List, Optional, Type, TypeVar, Union
from sqlalchemy import select, update, delete
from sqlalchemy.ext.asyncio import AsyncSession

ModelType = TypeVar("ModelType", bound=Base)


class BaseRepository(Generic[ModelType]):
    def __init__(self, model: Type[ModelType]):
        self.model = model

    async def get(self, db: AsyncSession, id: Any) -> Optional[ModelType]:
        """è·å–å•ä¸ªè®°å½•"""
        query = select(self.model).where(self.model.id == id)
        result = await db.execute(query)
        return result.scalar_one_or_none()

    async def get_multi(
        self,
        db: AsyncSession,
        *,
        skip: int = 0,
        limit: int = 100
    ) -> List[ModelType]:
        """è·å–å¤šä¸ªè®°å½•ï¼ˆåˆ†é¡µï¼‰"""
        query = select(self.model).offset(skip).limit(limit)
        result = await db.execute(query)
        return result.scalars().all()

    async def create(self, db: AsyncSession, *, obj_in: Union[ModelType, dict]) -> ModelType:
        """åˆ›å»ºè®°å½•"""
        # ä½¿ç”¨å‚æ•°åŒ–æŸ¥è¯¢é˜²æ­¢SQLæ³¨å…¥
        db_obj = self.model(**obj_in.dict() if isinstance(obj_in, BaseModel) else obj_in)
        db.add(db_obj)
        await db.commit()
        await db.refresh(db_obj)
        return db_obj
```

---

## 9. æµ‹è¯•ç­–ç•¥

### 9.1 åç«¯æµ‹è¯•

#### 9.1.1 æµ‹è¯•é…ç½® (pytest.ini)
```ini
[tool:pytest]
testpaths = tests
python_files = test_*.py
python_classes = Test*
python_functions = test_*
addopts =
    -v
    --strict-markers
    --strict-config
    --cov=app
    --cov-report=term-missing
    --cov-report=html:htmlcov
    --cov-fail-under=80
markers =
    unit: Unit tests
    integration: Integration tests
    slow: Slow running tests
```

#### 9.1.2 æµ‹è¯•å¤¹å…· (tests/conftest.py)
```python
import pytest
from sqlalchemy.ext.asyncio import AsyncSession, create_async_engine
from sqlalchemy.orm import sessionmaker

from app.config import settings
from app.db.base import Base
from app.models.user import User
from app.schemas.user import UserCreate


# åˆ›å»ºæµ‹è¯•æ•°æ®åº“å¼•æ“
test_engine = create_async_engine(settings.TEST_DATABASE_URL, echo=True)
TestSessionLocal = sessionmaker(
    test_engine, class_=AsyncSession, expire_on_commit=False
)


@pytest.fixture(scope="session")
async def test_db():
    """åˆ›å»ºæµ‹è¯•æ•°æ®åº“"""
    async with test_engine.begin() as conn:
        await conn.run_sync(Base.metadata.create_all)

    yield test_engine

    async with test_engine.begin() as conn:
        await conn.run_sync(Base.metadata.drop_all)


@pytest.fixture
async def db_session(test_db):
    """åˆ›å»ºæ•°æ®åº“ä¼šè¯"""
    connection = await test_engine.connect()
    transaction = await connection.begin()
    session = TestSessionLocal(bind=connection)

    yield session

    await session.close()
    await transaction.rollback()
    await connection.close()


@pytest.fixture
async def test_user(db_session: AsyncSession):
    """åˆ›å»ºæµ‹è¯•ç”¨æˆ·"""
    from app.services.user_service import UserService

    user_service = UserService()
    user_data = UserCreate(
        email="test@example.com",
        username="testuser",
        full_name="Test User",
        password="TestPass123"
    )

    user = await user_service.create(db_session, obj_in=user_data)
    return user
```

#### 9.1.3 å•å…ƒæµ‹è¯• (tests/unit/test_user_service.py)
```python
import pytest
from sqlalchemy.ext.asyncio import AsyncSession

from app.services.user_service import UserService
from app.schemas.user import UserCreate


class TestUserService:
    """ç”¨æˆ·æœåŠ¡æµ‹è¯•"""

    @pytest.mark.asyncio
    async def test_create_user(self, db_session: AsyncSession):
        """æµ‹è¯•åˆ›å»ºç”¨æˆ·"""
        user_service = UserService()
        user_data = UserCreate(
            email="newuser@example.com",
            username="newuser",
            full_name="New User",
            password="NewPass123"
        )

        user = await user_service.create(db_session, obj_in=user_data)

        assert user.email == user_data.email
        assert user.username == user_data.username
        assert user.is_active is True
        assert user.is_superuser is False
        assert user.id is not None

    @pytest.mark.asyncio
    async def test_get_user_by_email(self, db_session: AsyncSession, test_user):
        """æµ‹è¯•æ ¹æ®é‚®ç®±è·å–ç”¨æˆ·"""
        user_service = UserService()
        user = await user_service.get_by_email(db_session, email=test_user.email)

        assert user is not None
        assert user.email == test_user.email
        assert user.id == test_user.id

    @pytest.mark.asyncio
    async def test_authenticate_user(self, db_session: AsyncSession, test_user):
        """æµ‹è¯•ç”¨æˆ·è®¤è¯"""
        user_service = UserService()
        authenticated_user = await user_service.authenticate(
            db_session,
            email=test_user.email,
            password="TestPass123"
        )

        assert authenticated_user is not None
        assert authenticated_user.id == test_user.id

        # æµ‹è¯•é”™è¯¯å¯†ç 
        wrong_password_user = await user_service.authenticate(
            db_session,
            email=test_user.email,
            password="WrongPassword"
        )

        assert wrong_password_user is None
```

#### 9.1.4 é›†æˆæµ‹è¯• (tests/integration/test_api.py)
```python
import pytest
from fastapi.testclient import TestClient
from httpx import AsyncClient

from app.main import app


class TestUserAPI:
    """ç”¨æˆ·APIé›†æˆæµ‹è¯•"""

    @pytest.mark.asyncio
    async def test_create_user(self):
        """æµ‹è¯•åˆ›å»ºç”¨æˆ·API"""
        async with AsyncClient(app=app, base_url="http://test") as ac:
            response = await ac.post("/api/v1/users", json={
                "email": "apitest@example.com",
                "username": "apitest",
                "full_name": "API Test User",
                "password": "ApiTest123"
            })

        assert response.status_code == 201
        data = response.json()
        assert data["email"] == "apitest@example.com"
        assert data["username"] == "apitest"
        assert "id" in data
        assert "hashed_password" not in data

    @pytest.mark.asyncio
    async def test_get_users(self):
        """æµ‹è¯•è·å–ç”¨æˆ·åˆ—è¡¨API"""
        async with AsyncClient(app=app, base_url="http://test") as ac:
            response = await ac.get("/api/v1/users")

        assert response.status_code == 200
        data = response.json()
        assert isinstance(data, list)
```

### 9.2 å‰ç«¯æµ‹è¯•

#### 9.2.1 Vitesté…ç½® (vite.config.ts)
```typescript
import { defineConfig } from 'vite'
import vue from '@vitejs/plugin-vue'
import { resolve } from 'path'

export default defineConfig({
  plugins: [vue()],
  test: {
    globals: true,
    environment: 'jsdom',
    setupFiles: ['./tests/setup.ts'],
  },
})
```

#### 9.2.2 æµ‹è¯•è®¾ç½® (tests/setup.ts)
```typescript
import { beforeAll, vi } from 'vitest'
import { setActivePinia, createPinia } from 'pinia'

// è®¾ç½®Pinia
beforeAll(() => {
  const pinia = createPinia()
  setActivePinia(pinia)
})

// æ¨¡æ‹Ÿè·¯ç”±
vi.mock('vue-router', async () => {
  const actual = await vi.importActual('vue-router')
  return {
    ...actual,
    useRouter: () => ({
      push: vi.fn(),
      go: vi.fn(),
      back: vi.fn(),
    }),
    useRoute: () => ({
      params: {},
      query: {},
    }),
  }
})
```

#### 9.2.3 ç»„ä»¶æµ‹è¯• (tests/unit/components/UserCard.test.ts)
```typescript
import { describe, it, expect } from 'vitest'
import { mount } from '@vue/test-utils'
import UserCard from '@/components/UserCard.vue'

describe('UserCard', () => {
  it('renders user information correctly', () => {
    const user = {
      id: '1',
      email: 'test@example.com',
      username: 'testuser',
      full_name: 'Test User',
      is_active: true,
    }

    const wrapper = mount(UserCard, {
      props: { user },
    })

    expect(wrapper.text()).toContain('Test User')
    expect(wrapper.text()).toContain('test@example.com')
    expect(wrapper.find('.status-active').exists()).toBe(true)
  })

  it('emits edit event when edit button is clicked', async () => {
    const user = {
      id: '1',
      email: 'test@example.com',
      username: 'testuser',
      full_name: 'Test User',
      is_active: true,
    }

    const wrapper = mount(UserCard, {
      props: { user },
    })

    await wrapper.find('.edit-button').trigger('click')
    expect(wrapper.emitted('edit')).toBeTruthy()
    expect(wrapper.emitted('edit')[0]).toEqual([user])
  })
})
```

---

## 10. éƒ¨ç½²æ¶æ„

### 10.1 Dockeré…ç½®

#### 10.1.1 åç«¯Dockerfile
```dockerfile
# æ„å»ºé˜¶æ®µ
FROM python:3.11-slim as builder

WORKDIR /app

# å®‰è£…ç³»ç»Ÿä¾èµ–
RUN apt-get update && apt-get install -y \
    gcc \
    && rm -rf /var/lib/apt/lists/*

# å¤åˆ¶requirementsæ–‡ä»¶
COPY requirements.txt .

# å®‰è£…Pythonä¾èµ–
RUN pip install --user --no-cache-dir -r requirements.txt

# è¿è¡Œé˜¶æ®µ
FROM python:3.11-slim

WORKDIR /app

# åˆ›å»ºérootç”¨æˆ·
RUN groupadd -r appuser && useradd -r -g appuser appuser

# ä»æ„å»ºé˜¶æ®µå¤åˆ¶PythonåŒ…
COPY --from=builder /root/.local /home/appuser/.local

# å¤åˆ¶åº”ç”¨ä»£ç 
COPY --chown=appuser:appuser . .

# è®¾ç½®PATH
ENV PATH=/home/appuser/.local/bin:$PATH

# åˆ‡æ¢åˆ°érootç”¨æˆ·
USER appuser

# æš´éœ²ç«¯å£
EXPOSE 8000

# å¥åº·æ£€æŸ¥
HEALTHCHECK --interval=30s --timeout=30s --start-period=5s --retries=3 \
    CMD curl -f http://localhost:8000/health || exit 1

# å¯åŠ¨å‘½ä»¤
CMD ["uvicorn", "app.main:app", "--host", "0.0.0.0", "--port", "8000"]
```

#### 10.1.2 å‰ç«¯Dockerfile
```dockerfile
# æ„å»ºé˜¶æ®µ
FROM node:18-alpine as builder

WORKDIR /app

# å¤åˆ¶packageæ–‡ä»¶
COPY package*.json ./

# å®‰è£…ä¾èµ–
RUN npm ci

# å¤åˆ¶æºä»£ç 
COPY . .

# æ„å»ºåº”ç”¨
RUN npm run build

# ç”Ÿäº§é˜¶æ®µ
FROM nginx:alpine

# å¤åˆ¶æ„å»ºç»“æœ
COPY --from=builder /app/dist /usr/share/nginx/html

# å¤åˆ¶Nginxé…ç½®
COPY nginx.conf /etc/nginx/conf.d/default.conf

# æš´éœ²ç«¯å£
EXPOSE 80

# å¯åŠ¨Nginx
CMD ["nginx", "-g", "daemon off;"]
```

#### 10.1.3 Nginxé…ç½®
```nginx
server {
    listen 80;
    server_name localhost;
    root /usr/share/nginx/html;
    index index.html;

    # Gzipå‹ç¼©
    gzip on;
    gzip_vary on;
    gzip_min_length 1024;
    gzip_types text/plain text/css text/xml text/javascript application/javascript application/xml+rss application/json;

    # ç¼“å­˜é™æ€èµ„æº
    location ~* \.(js|css|png|jpg|jpeg|gif|ico|svg|woff|woff2)$ {
        expires 1y;
        add_header Cache-Control "public, immutable";
    }

    # å¤„ç†Vue Routerçš„Historyæ¨¡å¼
    location / {
        try_files $uri $uri/ /index.html;
    }

    # APIä»£ç†
    location /api/ {
        proxy_pass http://backend:8000;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
    }
}
```

### 10.2 Docker Compose

#### 10.2.1 æ ¹ç›®å½•docker-compose.yml
```yaml
version: '3.8'

services:
  # PostgreSQLæ•°æ®åº“
  postgres:
    image: postgres:15-alpine
    container_name: app_postgres
    environment:
      POSTGRES_USER: ${POSTGRES_USER:-postgres}
      POSTGRES_PASSWORD: ${POSTGRES_PASSWORD:-postgres}
      POSTGRES_DB: ${POSTGRES_DB:-app}
    volumes:
      - postgres_data:/var/lib/postgresql/data
    ports:
      - "${POSTGRES_PORT:-5432}:5432"
    healthcheck:
      test: ["CMD-SHELL", "pg_isready -U ${POSTGRES_USER:-postgres}"]
      interval: 10s
      timeout: 5s
      retries: 5

  # Redisç¼“å­˜
  redis:
    image: redis:7-alpine
    container_name: app_redis
    ports:
      - "${REDIS_PORT:-6379}:6379"
    volumes:
      - redis_data:/data
    healthcheck:
      test: ["CMD", "redis-cli", "ping"]
      interval: 10s
      timeout: 5s
      retries: 5

  # åç«¯API
  backend:
    build:
      context: ./backend
      dockerfile: Dockerfile
    container_name: app_backend
    environment:
      - DATABASE_URL=postgresql+asyncpg://${POSTGRES_USER:-postgres}:${POSTGRES_PASSWORD:-postgres}@postgres:5432/${POSTGRES_DB:-app}
      - REDIS_HOST=redis
      - REDIS_PORT=6379
      - SECRET_KEY=${SECRET_KEY}
    depends_on:
      postgres:
        condition: service_healthy
      redis:
        condition: service_healthy
    ports:
      - "${BACKEND_PORT:-8000}:8000"
    volumes:
      - ./backend:/app
    command: uvicorn app.main:app --host 0.0.0.0 --port 8000 --reload

  # å‰ç«¯åº”ç”¨
  frontend:
    build:
      context: ./frontend
      dockerfile: Dockerfile
    container_name: app_frontend
    depends_on:
      - backend
    ports:
      - "${FRONTEND_PORT:-3000}:80"

  # Nginxåå‘ä»£ç†
  nginx:
    image: nginx:alpine
    container_name: app_nginx
    depends_on:
      - frontend
      - backend
    ports:
      - "${NGINX_PORT:-80}:80"
    volumes:
      - ./nginx/nginx.conf:/etc/nginx/nginx.conf:ro

volumes:
  postgres_data:
  redis_data:
```

#### 10.2.2 ç¯å¢ƒå˜é‡æ–‡ä»¶ (.env)
```bash
# æ•°æ®åº“é…ç½®
POSTGRES_USER=postgres
POSTGRES_PASSWORD=postgres
POSTGRES_DB=app
POSTGRES_PORT=5432

# Redisé…ç½®
REDIS_PORT=6379

# åº”ç”¨é…ç½®
SECRET_KEY=your-secret-key-change-in-production
BACKEND_PORT=8000
FRONTEND_PORT=3000
NGINX_PORT=80
```

### 10.3 ç”Ÿäº§éƒ¨ç½²

#### 10.3.1 ä½¿ç”¨Docker Composeéƒ¨ç½²
```bash
# 1. å…‹éš†é¡¹ç›®
git clone <repository-url>
cd project-root

# 2. é…ç½®ç¯å¢ƒå˜é‡
cp .env.example .env
vim .env

# 3. æ„å»ºå¹¶å¯åŠ¨æœåŠ¡
docker-compose up -d

# 4. æŸ¥çœ‹æ—¥å¿—
docker-compose logs -f

# 5. è¿è¡Œæ•°æ®åº“è¿ç§»
docker-compose exec backend alembic upgrade head

# 6. åˆ›å»ºè¶…çº§ç”¨æˆ·
docker-compose exec backend python -c "from app.core.security import get_password_hash; from app.db.session import SessionLocal; from app.models.user import User; ..."

# 7. è®¿é—®åº”ç”¨
# å‰ç«¯: http://localhost
# åç«¯API: http://localhost/api/v1
# APIæ–‡æ¡£: http://localhost/docs
```

#### 10.3.2 æ¸…ç†ç¯å¢ƒ
```bash
# åœæ­¢æ‰€æœ‰æœåŠ¡
docker-compose down

# åœæ­¢å¹¶åˆ é™¤æ•°æ®å·
docker-compose down -v

# é‡æ–°æ„å»ºé•œåƒ
docker-compose up -d --build

# æŸ¥çœ‹èµ„æºä½¿ç”¨
docker-compose top
```

---

## 11. å¼€å‘å·¥å…·é…ç½®

### 11.1 åç«¯å·¥å…·é…ç½®

#### 11.1.1 Blacké…ç½® (.black)
```ini
[tool.black]
line-length = 88
target-version = ['py311']
include = '\.pyi?$'
extend-exclude = '''
/(
  # æ’é™¤ç›®å½•
  migrations
  | __pycache__
  | venv
)/
'''
```

#### 11.1.2 isorté…ç½® (.isort.cfg)
```ini
[settings]
profile = black
multi_line_output = 3
line_length = 88
known_first_party = app
known_third_party = fastapi,sqlalchemy,pytest
skip_glob = migrations/*
```

#### 11.1.3 Flake8é…ç½® (.flake8)
```ini
[flake8]
max-line-length = 88
extend-ignore = E203, W503
exclude =
    .git,
    __pycache__,
    venv,
    migrations
per-file-ignores =
    __init__.py:F401
```

#### 11.1.4 MyPyé…ç½® (mypy.ini)
```ini
[mypy]
python_version = 3.11
warn_return_any = True
warn_unused_configs = True
disallow_untyped_defs = True
disallow_incomplete_defs = True
check_untyped_defs = True
disallow_untyped_decorators = True
no_implicit_optional = True
warn_redundant_casts = True
warn_unused_ignores = True
warn_no_return = True
warn_unreachable = True
strict_equality = True

[mypy-tests.*]
disallow_untyped_defs = False
```

#### 11.1.5 pre-commité…ç½® (.pre-commit-config.yaml)
```yaml
repos:
  - repo: https://github.com/pre-commit/pre-commit-hooks
    rev: v4.5.0
    hooks:
      - id: trailing-whitespace
      - id: end-of-file-fixer
      - id: check-yaml
      - id: check-added-large-files

  - repo: https://github.com/psf/black
    rev: 23.12.1
    hooks:
      - id: black
        language_version: python3.11

  - repo: https://github.com/pycqa/isort
    rev: 5.13.2
    hooks:
      - id: isort
        args: ["--profile", "black"]

  - repo: https://github.com/pycqa/flake8
    rev: 7.0.0
    hooks:
      - id: flake8

  - repo: https://github.com/pre-commit/mirrors-mypy
    rev: v1.8.0
    hooks:
      - id: mypy
        additional_dependencies: [types-all]
```

### 11.2 å‰ç«¯å·¥å…·é…ç½®

#### 11.2.1 ESLinté…ç½® (.eslintrc.js)
```javascript
module.exports = {
  root: true,
  env: {
    node: true,
    browser: true,
    es2021: true,
  },
  extends: [
    'eslint:recommended',
    'plugin:vue/vue3-recommended',
    'plugin:@typescript-eslint/recommended',
    'plugin:vue/vue3-essential',
    '@vue/typescript/recommended',
    '@vue/prettier',
  ],
  parser: 'vue-eslint-parser',
  parserOptions: {
    ecmaVersion: 'latest',
    parser: '@typescript-eslint/parser',
    sourceType: 'module',
  },
  plugins: ['vue', '@typescript-eslint'],
  rules: {
    'vue/multi-word-component-names': 'off',
    '@typescript-eslint/no-explicit-any': 'warn',
    '@typescript-eslint/no-unused-vars': ['error', { argsIgnorePattern: '^_' }],
  },
  globals: {
    defineProps: 'readonly',
    defineEmits: 'readonly',
    defineExpose: 'readonly',
    withDefaults: 'readonly',
  },
}
```

#### 11.2.2 Prettieré…ç½® (.prettierrc)
```json
{
  "semi": false,
  "singleQuote": true,
  "tabWidth": 2,
  "trailingComma": "es5",
  "printWidth": 100,
  "bracketSpacing": true,
  "arrowParens": "avoid",
  "endOfLine": "lf",
  "vueIndentScriptAndStyle": false
}
```

#### 11.2.3 package.jsonè„šæœ¬
```json
{
  "scripts": {
    "dev": "vite",
    "build": "vue-tsc && vite build",
    "preview": "vite preview",
    "test": "vitest",
    "test:ui": "vitest --ui",
    "test:coverage": "vitest run --coverage",
    "lint": "eslint . --ext .vue,.js,.ts --fix",
    "format": "prettier --write src/",
    "type-check": "vue-tsc --noEmit"
  }
}
```

---

## 12. éªŒæ”¶æ ‡å‡†

### 12.1 åŠŸèƒ½éªŒæ”¶

#### 12.1.1 åç«¯API
- [ ] æ‰€æœ‰APIç«¯ç‚¹å¯æ­£å¸¸è®¿é—®
- [ ] CRUDæ“ä½œæ­£å¸¸å·¥ä½œ
- [ ] è®¤è¯/æˆæƒæœºåˆ¶æœ‰æ•ˆ
- [ ] è¾“å…¥éªŒè¯æ­£å¸¸å·¥ä½œ
- [ ] é”™è¯¯å¤„ç†å’ŒçŠ¶æ€ç æ­£ç¡®
- [ ] APIæ–‡æ¡£å¯æ­£å¸¸ç”Ÿæˆå’Œè®¿é—®

#### 12.1.2 å‰ç«¯åº”ç”¨
- [ ] é¡µé¢å¯æ­£å¸¸åŠ è½½å’Œæ¸²æŸ“
- [ ] è·¯ç”±è·³è½¬æ­£å¸¸å·¥ä½œ
- [ ] ç”¨æˆ·äº¤äº’å“åº”æ­£ç¡®
- [ ] APIè°ƒç”¨æ­£å¸¸å·¥ä½œ
- [ ] çŠ¶æ€ç®¡ç†æ­£ç¡®
- [ ] è¡¨å•éªŒè¯æœ‰æ•ˆ
- [ ] é”™è¯¯æç¤ºå‹å¥½

### 12.2 è´¨é‡éªŒæ”¶

#### 12.2.1 ä»£ç è´¨é‡
- [ ] ä»£ç è¦†ç›–ç‡ â‰¥ 80%
- [ ] æ— P0/P1çº§åˆ«ä»£ç é—®é¢˜
- [ ] é€šè¿‡æ‰€æœ‰é™æ€æ£€æŸ¥ï¼ˆESLintã€Flake8ã€MyPyï¼‰
- [ ] éµå¾ªä»£ç è§„èŒƒå’Œæœ€ä½³å®è·µ
- [ ] æ³¨é‡Šå®Œæ•´æ¸…æ™°
- [ ] ç±»å‹æ³¨è§£å®Œæ•´

#### 12.2.2 æ€§èƒ½æŒ‡æ ‡
- [ ] APIå“åº”æ—¶é—´ < 200ms (95%åˆ†ä½)
- [ ] å‰ç«¯é¦–å±åŠ è½½æ—¶é—´ < 3s
- [ ] æ•°æ®åº“æŸ¥è¯¢ä¼˜åŒ–ï¼ˆæ— N+1é—®é¢˜ï¼‰
- [ ] åˆç†ä½¿ç”¨ç¼“å­˜

#### 12.2.3 å®‰å…¨æ£€æŸ¥
- [ ] æ— é«˜å±å®‰å…¨æ¼æ´
- [ ] å¯†ç åŠ å¯†å­˜å‚¨
- [ ] SQLæ³¨å…¥é˜²æŠ¤
- [ ] XSSæ”»å‡»é˜²æŠ¤
- [ ] CSRFä¿æŠ¤
- [ ] æ•æ„Ÿä¿¡æ¯ä¸æš´éœ²

### 12.3 æ–‡æ¡£éªŒæ”¶

- [ ] README.mdå®Œæ•´å‡†ç¡®
- [ ] APIæ–‡æ¡£è¯¦ç»†æ¸…æ™°
- [ ] éƒ¨ç½²æ–‡æ¡£å¯æ‰§è¡Œ
- [ ] ä»£ç æ³¨é‡Šå……åˆ†
- [ ] æ¶æ„æ–‡æ¡£æ¸…æ™°
- [ ] å¿«é€Ÿå¯åŠ¨æŒ‡å—æœ‰æ•ˆ

### 12.4 éƒ¨ç½²éªŒæ”¶

- [ ] Dockeré•œåƒæ„å»ºæˆåŠŸ
- [ ] Docker Composeå¯åŠ¨æˆåŠŸ
- [ ] æ•°æ®åº“è¿ç§»æ‰§è¡ŒæˆåŠŸ
- [ ] æœåŠ¡é—´é€šä¿¡æ­£å¸¸
- [ ] ç¯å¢ƒå˜é‡é…ç½®æ­£ç¡®
- [ ] å¥åº·æ£€æŸ¥é€šè¿‡

### 12.5 éªŒæ”¶æµç¨‹

```bash
# 1. å…‹éš†é¡¹ç›®
git clone <repository-url>
cd project-root

# 2. å¯åŠ¨æœåŠ¡
docker-compose up -d

# 3. è¿è¡Œæµ‹è¯•
cd backend && pytest
cd frontend && npm test

# 4. æ£€æŸ¥è¦†ç›–ç‡
cd backend && pytest --cov=app --cov-report=html

# 5. è®¿é—®åº”ç”¨
# å‰ç«¯: http://localhost
# APIæ–‡æ¡£: http://localhost/docs

# 6. æ‰‹åŠ¨æµ‹è¯•
# - æ³¨å†Œç”¨æˆ·
# - ç™»å½•
# - åˆ›å»ºé¡¹ç›®
# - åˆ›å»ºä»»åŠ¡
# - æŸ¥çœ‹æ•°æ®

# 7. æ£€æŸ¥æ—¥å¿—
docker-compose logs -f
```

---

## ğŸ“š é™„å½•

### A. å¸¸ç”¨å‘½ä»¤

#### A.1 åç«¯å‘½ä»¤
```bash
# å¯åŠ¨å¼€å‘æœåŠ¡å™¨
uvicorn app.main:app --reload --port 8000

# è¿è¡Œæµ‹è¯•
pytest

# ç”Ÿæˆè¦†ç›–ç‡æŠ¥å‘Š
pytest --cov=app --cov-report=html

# æ•°æ®åº“è¿ç§»
alembic revision --autogenerate -m "message"
alembic upgrade head

# ä»£ç æ ¼å¼åŒ–
black .
isort .

# é™æ€æ£€æŸ¥
flake8
mypy app
```

#### A.2 å‰ç«¯å‘½ä»¤
```bash
# å¯åŠ¨å¼€å‘æœåŠ¡å™¨
npm run dev

# æ„å»ºç”Ÿäº§ç‰ˆæœ¬
npm run build

# é¢„è§ˆæ„å»ºç»“æœ
npm run preview

# è¿è¡Œæµ‹è¯•
npm test

# ä»£ç æ£€æŸ¥
npm run lint

# ä»£ç æ ¼å¼åŒ–
npm run format
```

### B. å¸¸è§é—®é¢˜

#### B.1 æ•°æ®åº“è¿æ¥å¤±è´¥
```bash
# æ£€æŸ¥æ•°æ®åº“æ˜¯å¦å¯åŠ¨
docker-compose ps postgres

# æŸ¥çœ‹æ•°æ®åº“æ—¥å¿—
docker-compose logs postgres

# é‡å¯æ•°æ®åº“
docker-compose restart postgres
```

#### B.2 å‰ç«¯æ— æ³•è¿æ¥åç«¯
- æ£€æŸ¥CORSé…ç½®
- æ£€æŸ¥ä»£ç†é…ç½®
- æ£€æŸ¥APIåœ°å€æ˜¯å¦æ­£ç¡®

#### B.3 ç«¯å£å ç”¨
```bash
# æŸ¥çœ‹ç«¯å£å ç”¨
lsof -i :8000
netstat -tulpn | grep :8000

# ä¿®æ”¹ç«¯å£
# backend/.env
BACKEND_PORT=8001

# docker-compose.yml
BACKEND_PORT=8001
```

### C. å‚è€ƒèµ„æº

- [FastAPIå®˜æ–¹æ–‡æ¡£](https://fastapi.tiangolo.com/)
- [Vue.jså®˜æ–¹æ–‡æ¡£](https://vuejs.org/)
- [SQLAlchemyæ–‡æ¡£](https://docs.sqlalchemy.org/)
- [Dockerå®˜æ–¹æ–‡æ¡£](https://docs.docker.com/)
- [Clean Architecture](https://blog.cleancoder.com/uncle-bob/2012/08/13/the-clean-architecture.html)

---

**æ–‡æ¡£ç»“æŸ**

> æœ¬æ–‡æ¡£ä¸º"é˜¶æ®µä¸€ï¼šæ­å»ºå‰åç«¯æ¡†æ¶"çš„å®Œæ•´æŒ‡å¯¼è§„èŒƒï¼Œéµå¾ªæ­¤æ–‡æ¡£å¯å¿«é€Ÿæ­å»ºé«˜è´¨é‡çš„ç°ä»£åŒ–å‰åç«¯åˆ†ç¦»é¡¹ç›®ã€‚
>
> å¦‚æœ‰ç–‘é—®æˆ–å»ºè®®ï¼Œè¯·æŸ¥é˜…ç›¸å…³æŠ€æœ¯æ ˆçš„å®˜æ–¹æ–‡æ¡£æˆ–è”ç³»å¼€å‘å›¢é˜Ÿã€‚
